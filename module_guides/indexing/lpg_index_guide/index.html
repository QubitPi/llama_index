
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://docs.llamaindex.ai/en/stable/module_guides/indexing/lpg_index_guide/">
      
      
        <link rel="prev" href="../vector_store_index/">
      
      
        <link rel="next" href="../document_management/">
      
      
      <link rel="icon" href="../../../_static/assets/LlamaLogoBrowserTab.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.14">
    
    
      
        <title>Property Graph Index - LlamaIndex</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.342714a4.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../../css/style.css">
    
      <link rel="stylesheet" href="../../../css/algolia.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-BYVB1ZVE6J"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-BYVB1ZVE6J",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-BYVB1ZVE6J",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script>
  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#using-a-property-graph-index" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="LlamaIndex" class="md-header__button md-logo" aria-label="LlamaIndex" data-md-component="logo">
      
  <img src="../../../_static/assets/LlamaSquareBlack.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            LlamaIndex
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Property Graph Index
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="purple"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="purple"  aria-label="Switch to system preference"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to system preference" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        

<!-- Search interface -->
<div id="docsearch"></div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../.." class="md-tabs__link">
          
  
  
    
  
  Home

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../understanding/" class="md-tabs__link">
          
  
  
    
  
  Learn

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../use_cases/" class="md-tabs__link">
          
  
  
    
  
  Use Cases

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../examples/" class="md-tabs__link">
          
  
  
    
  
  Examples

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../" class="md-tabs__link">
          
  
  
    
  
  Component Guides

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../optimizing/production_rag/" class="md-tabs__link">
          
  
  
    
  
  Advanced Topics

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../api_reference/" class="md-tabs__link">
          
  
  
    
  
  API Reference

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../community/integrations/" class="md-tabs__link">
          
  
  
    
  
  Open-Source Community

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../llama_cloud/" class="md-tabs__link">
          
  
  
    
  
  LlamaCloud

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="LlamaIndex" class="md-nav__button md-logo" aria-label="LlamaIndex" data-md-component="logo">
      
  <img src="../../../_static/assets/LlamaSquareBlack.svg" alt="logo">

    </a>
    LlamaIndex
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../.." class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../../understanding/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Learn
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../../use_cases/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Use Cases
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../../examples/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Examples
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
        
        
      
      
    
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Component Guides
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5" id="__nav_5_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Component Guides
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../models/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Models
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../models/prompts/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Prompts
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../loading/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Loading
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_5" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Indexing
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_5" id="__nav_5_5_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5_5">
            <span class="md-nav__icon md-icon"></span>
            Indexing
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../index_guide/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Index Guide
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../vector_store_index/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Vector Store Index
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Property Graph Index
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Property Graph Index
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#usage" class="md-nav__link">
    <span class="md-ellipsis">
      Usage
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Usage">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#construction" class="md-nav__link">
    <span class="md-ellipsis">
      Construction
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Construction">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#default-simplellmpathextractor" class="md-nav__link">
    <span class="md-ellipsis">
      (default) SimpleLLMPathExtractor
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#default-implicitpathextractor" class="md-nav__link">
    <span class="md-ellipsis">
      (default) ImplicitPathExtractor
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dynamicllmpathextractor" class="md-nav__link">
    <span class="md-ellipsis">
      DynamicLLMPathExtractor
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DynamicLLMPathExtractor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#schemallmpathextractor" class="md-nav__link">
    <span class="md-ellipsis">
      SchemaLLMPathExtractor
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#retrieval-and-querying" class="md-nav__link">
    <span class="md-ellipsis">
      Retrieval and Querying
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Retrieval and Querying">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#default-llmsynonymretriever" class="md-nav__link">
    <span class="md-ellipsis">
      (default) LLMSynonymRetriever
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#default-if-supported-vectorcontextretriever" class="md-nav__link">
    <span class="md-ellipsis">
      (default, if supported) VectorContextRetriever
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#texttocypherretriever" class="md-nav__link">
    <span class="md-ellipsis">
      TextToCypherRetriever
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cyphertemplateretriever" class="md-nav__link">
    <span class="md-ellipsis">
      CypherTemplateRetriever
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#storage" class="md-nav__link">
    <span class="md-ellipsis">
      Storage
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Storage">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#saving-tofrom-disk" class="md-nav__link">
    <span class="md-ellipsis">
      Saving to/from disk
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#saving-and-loading-with-integrations" class="md-nav__link">
    <span class="md-ellipsis">
      Saving and Loading with Integrations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-the-property-graph-store-directly" class="md-nav__link">
    <span class="md-ellipsis">
      Using the Property Graph Store Directly
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#advanced-customization" class="md-nav__link">
    <span class="md-ellipsis">
      Advanced Customization
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Advanced Customization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sub-classing-extractors" class="md-nav__link">
    <span class="md-ellipsis">
      Sub-Classing Extractors
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sub-classing-retrievers" class="md-nav__link">
    <span class="md-ellipsis">
      Sub-Classing Retrievers
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../document_management/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Document Management
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../llama_cloud_index/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    LlamaCloud
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../metadata_extraction/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Metadata Extraction
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../modules/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Modules
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../storing/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Storing
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../querying/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Querying
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../deploying/agents/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Agents
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../workflow/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Workflows
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../evaluating/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Evaluation
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../observability/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Observability
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../supporting_modules/settings/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Settings
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../llama_deploy" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Llama Deploy
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../../optimizing/production_rag/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Advanced Topics
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../../api_reference/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    API Reference
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../../community/integrations/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Open-Source Community
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../../llama_cloud/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    LlamaCloud
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#usage" class="md-nav__link">
    <span class="md-ellipsis">
      Usage
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Usage">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#construction" class="md-nav__link">
    <span class="md-ellipsis">
      Construction
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Construction">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#default-simplellmpathextractor" class="md-nav__link">
    <span class="md-ellipsis">
      (default) SimpleLLMPathExtractor
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#default-implicitpathextractor" class="md-nav__link">
    <span class="md-ellipsis">
      (default) ImplicitPathExtractor
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dynamicllmpathextractor" class="md-nav__link">
    <span class="md-ellipsis">
      DynamicLLMPathExtractor
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DynamicLLMPathExtractor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#schemallmpathextractor" class="md-nav__link">
    <span class="md-ellipsis">
      SchemaLLMPathExtractor
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#retrieval-and-querying" class="md-nav__link">
    <span class="md-ellipsis">
      Retrieval and Querying
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Retrieval and Querying">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#default-llmsynonymretriever" class="md-nav__link">
    <span class="md-ellipsis">
      (default) LLMSynonymRetriever
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#default-if-supported-vectorcontextretriever" class="md-nav__link">
    <span class="md-ellipsis">
      (default, if supported) VectorContextRetriever
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#texttocypherretriever" class="md-nav__link">
    <span class="md-ellipsis">
      TextToCypherRetriever
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cyphertemplateretriever" class="md-nav__link">
    <span class="md-ellipsis">
      CypherTemplateRetriever
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#storage" class="md-nav__link">
    <span class="md-ellipsis">
      Storage
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Storage">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#saving-tofrom-disk" class="md-nav__link">
    <span class="md-ellipsis">
      Saving to/from disk
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#saving-and-loading-with-integrations" class="md-nav__link">
    <span class="md-ellipsis">
      Saving and Loading with Integrations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-the-property-graph-store-directly" class="md-nav__link">
    <span class="md-ellipsis">
      Using the Property Graph Store Directly
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#advanced-customization" class="md-nav__link">
    <span class="md-ellipsis">
      Advanced Customization
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Advanced Customization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sub-classing-extractors" class="md-nav__link">
    <span class="md-ellipsis">
      Sub-Classing Extractors
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sub-classing-retrievers" class="md-nav__link">
    <span class="md-ellipsis">
      Sub-Classing Retrievers
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="using-a-property-graph-index">Using a Property Graph Index<a class="headerlink" href="#using-a-property-graph-index" title="Permanent link">#</a></h1>
<p>A property graph is a knowledge collection of labeled nodes (i.e. entity categories, text labels, etc.) with properties (i.e. metadata), linked together by relationships into structured paths.</p>
<p>In LlamaIndex, the <code>PropertyGraphIndex</code> provides key orchestration around</p>
<ul>
<li>constructing a graph</li>
<li>querying a graph</li>
</ul>
<h2 id="usage">Usage<a class="headerlink" href="#usage" title="Permanent link">#</a></h2>
<p>Basic usage can be found by simply importing the class and using it:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">llama_index.core</span> <span class="kn">import</span> <span class="n">PropertyGraphIndex</span>

<span class="c1"># create</span>
<span class="n">index</span> <span class="o">=</span> <span class="n">PropertyGraphIndex</span><span class="o">.</span><span class="n">from_documents</span><span class="p">(</span>
    <span class="n">documents</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># use</span>
<span class="n">retriever</span> <span class="o">=</span> <span class="n">index</span><span class="o">.</span><span class="n">as_retriever</span><span class="p">(</span>
    <span class="n">include_text</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># include source chunk with matching paths</span>
    <span class="n">similarity_top_k</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>  <span class="c1"># top k for vector kg node retrieval</span>
<span class="p">)</span>
<span class="n">nodes</span> <span class="o">=</span> <span class="n">retriever</span><span class="o">.</span><span class="n">retrieve</span><span class="p">(</span><span class="s2">&quot;Test&quot;</span><span class="p">)</span>

<span class="n">query_engine</span> <span class="o">=</span> <span class="n">index</span><span class="o">.</span><span class="n">as_query_engine</span><span class="p">(</span>
    <span class="n">include_text</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># include source chunk with matching paths</span>
    <span class="n">similarity_top_k</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>  <span class="c1"># top k for vector kg node retrieval</span>
<span class="p">)</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">query_engine</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;Test&quot;</span><span class="p">)</span>

<span class="c1"># save and load</span>
<span class="n">index</span><span class="o">.</span><span class="n">storage_context</span><span class="o">.</span><span class="n">persist</span><span class="p">(</span><span class="n">persist_dir</span><span class="o">=</span><span class="s2">&quot;./storage&quot;</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">llama_index.core</span> <span class="kn">import</span> <span class="n">StorageContext</span><span class="p">,</span> <span class="n">load_index_from_storage</span>

<span class="n">index</span> <span class="o">=</span> <span class="n">load_index_from_storage</span><span class="p">(</span>
    <span class="n">StorageContext</span><span class="o">.</span><span class="n">from_defaults</span><span class="p">(</span><span class="n">persist_dir</span><span class="o">=</span><span class="s2">&quot;./storage&quot;</span><span class="p">)</span>
<span class="p">)</span>

<span class="c1"># loading from existing graph store (and optional vector store)</span>
<span class="c1"># load from existing graph/vector store</span>
<span class="n">index</span> <span class="o">=</span> <span class="n">PropertyGraphIndex</span><span class="o">.</span><span class="n">from_existing</span><span class="p">(</span>
    <span class="n">property_graph_store</span><span class="o">=</span><span class="n">graph_store</span><span class="p">,</span> <span class="n">vector_store</span><span class="o">=</span><span class="n">vector_store</span><span class="p">,</span> <span class="o">...</span>
<span class="p">)</span>
</code></pre></div>
<h3 id="construction">Construction<a class="headerlink" href="#construction" title="Permanent link">#</a></h3>
<p>Property graph construction in LlamaIndex works by performing a series of <code>kg_extractors</code> on each chunk, and attaching entities and relations as metadata to each llama-index node. You can use as many as you like here, and they will all get applied.</p>
<p>If you've used transformations or metadata extractors with the <a href="../../loading/ingestion_pipeline/">ingestion pipeline</a>, then this will be very familiar (and these <code>kg_extractors</code> are compatible with the ingestion pipeline)!</p>
<p>Extractors are set using the appropriate kwarg:</p>
<div class="highlight"><pre><span></span><code><span class="n">index</span> <span class="o">=</span> <span class="n">PropertyGraphIndex</span><span class="o">.</span><span class="n">from_documents</span><span class="p">(</span>
    <span class="n">documents</span><span class="p">,</span>
    <span class="n">kg_extractors</span><span class="o">=</span><span class="p">[</span><span class="n">extractor1</span><span class="p">,</span> <span class="n">extractor2</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span>
<span class="p">)</span>

<span class="c1"># insert additional documents / nodes</span>
<span class="n">index</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">document</span><span class="p">)</span>
<span class="n">index</span><span class="o">.</span><span class="n">insert_nodes</span><span class="p">(</span><span class="n">nodes</span><span class="p">)</span>
</code></pre></div>
<p>If not provided, the defaults are <code>SimpleLLMPathExtractor</code> and <code>ImplicitPathExtractor</code>.</p>
<p>All <code>kg_extractors</code> are detailed below.</p>
<h4 id="default-simplellmpathextractor">(default) <code>SimpleLLMPathExtractor</code><a class="headerlink" href="#default-simplellmpathextractor" title="Permanent link">#</a></h4>
<p>Extract short statements using an LLM to prompt and parse single-hop paths in the format (<code>entity1</code>, <code>relation</code>, <code>entity2</code>)</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">llama_index.core.indices.property_graph</span> <span class="kn">import</span> <span class="n">SimpleLLMPathExtractor</span>

<span class="n">kg_extractor</span> <span class="o">=</span> <span class="n">SimpleLLMPathExtractor</span><span class="p">(</span>
    <span class="n">llm</span><span class="o">=</span><span class="n">llm</span><span class="p">,</span>
    <span class="n">max_paths_per_chunk</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">num_workers</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
    <span class="n">show_progress</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>
<p>If you want, you can also customize the prompt and the function used to parse the paths.</p>
<p>Here's a simple (but naive) example:</p>
<div class="highlight"><pre><span></span><code><span class="n">prompt</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s2">&quot;Some text is provided below. Given the text, extract up to &quot;</span>
    <span class="s2">&quot;</span><span class="si">{max_paths_per_chunk}</span><span class="s2"> &quot;</span>
    <span class="s2">&quot;knowledge triples in the form of `subject,predicate,object` on each line. Avoid stopwords.</span><span class="se">\n</span><span class="s2">&quot;</span>
<span class="p">)</span>


<span class="k">def</span> <span class="nf">parse_fn</span><span class="p">(</span><span class="n">response_str</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]:</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="n">response_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">triples</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">triples</span>


<span class="n">kg_extractor</span> <span class="o">=</span> <span class="n">SimpleLLMPathExtractor</span><span class="p">(</span>
    <span class="n">llm</span><span class="o">=</span><span class="n">llm</span><span class="p">,</span>
    <span class="n">extract_prompt</span><span class="o">=</span><span class="n">prompt</span><span class="p">,</span>
    <span class="n">parse_fn</span><span class="o">=</span><span class="n">parse_fn</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>
<h4 id="default-implicitpathextractor">(default) <code>ImplicitPathExtractor</code><a class="headerlink" href="#default-implicitpathextractor" title="Permanent link">#</a></h4>
<p>Extract paths using the <code>node.relationships</code> attribute on each llama-index node object.</p>
<p>This extractor does not need an LLM or embedding model to run, since it's merely parsing properties that already exist on llama-index node objects.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">llama_index.core.indices.property_graph</span> <span class="kn">import</span> <span class="n">ImplicitPathExtractor</span>

<span class="n">kg_extractor</span> <span class="o">=</span> <span class="n">ImplicitPathExtractor</span><span class="p">()</span>
</code></pre></div>
<h3 id="dynamicllmpathextractor"><code>DynamicLLMPathExtractor</code><a class="headerlink" href="#dynamicllmpathextractor" title="Permanent link">#</a></h3>
<p>Will extract paths (including entity types!) according to optional list of allowed entity types and relation types. If none are provided, then the LLM will assign types as it sees fit. If they are provided, it will help guide the LLM, but will not enforce exactly those types.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">llama_index.core.indices.property_graph</span> <span class="kn">import</span> <span class="n">DynamicLLMPathExtractor</span>

<span class="n">kg_extractor</span> <span class="o">=</span> <span class="n">DynamicLLMPathExtractor</span><span class="p">(</span>
    <span class="n">llm</span><span class="o">=</span><span class="n">llm</span><span class="p">,</span>
    <span class="n">max_triplets_per_chunk</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
    <span class="n">num_workers</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
    <span class="n">allowed_entity_types</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;POLITICIAN&quot;</span><span class="p">,</span> <span class="s2">&quot;POLITICAL_PARTY&quot;</span><span class="p">],</span>
    <span class="n">allowed_relation_types</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;PRESIDENT_OF&quot;</span><span class="p">,</span> <span class="s2">&quot;MEMBER_OF&quot;</span><span class="p">],</span>
<span class="p">)</span>
</code></pre></div>
<h4 id="schemallmpathextractor"><code>SchemaLLMPathExtractor</code><a class="headerlink" href="#schemallmpathextractor" title="Permanent link">#</a></h4>
<p>Extract paths following a strict schema of allowed entities, relationships, and which entities can be connected to which relationships.</p>
<p>Using pydantic, structured outputs from LLMs, and some clever validation, we can dynamically specify a schema and verify the extractions per-path.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Literal</span>
<span class="kn">from</span> <span class="nn">llama_index.core.indices.property_graph</span> <span class="kn">import</span> <span class="n">SchemaLLMPathExtractor</span>

<span class="c1"># recommended uppercase, underscore separated</span>
<span class="n">entities</span> <span class="o">=</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;PERSON&quot;</span><span class="p">,</span> <span class="s2">&quot;PLACE&quot;</span><span class="p">,</span> <span class="s2">&quot;THING&quot;</span><span class="p">]</span>
<span class="n">relations</span> <span class="o">=</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;PART_OF&quot;</span><span class="p">,</span> <span class="s2">&quot;HAS&quot;</span><span class="p">,</span> <span class="s2">&quot;IS_A&quot;</span><span class="p">]</span>
<span class="n">schema</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;PERSON&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;PART_OF&quot;</span><span class="p">,</span> <span class="s2">&quot;HAS&quot;</span><span class="p">,</span> <span class="s2">&quot;IS_A&quot;</span><span class="p">],</span>
    <span class="s2">&quot;PLACE&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;PART_OF&quot;</span><span class="p">,</span> <span class="s2">&quot;HAS&quot;</span><span class="p">],</span>
    <span class="s2">&quot;THING&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;IS_A&quot;</span><span class="p">],</span>
<span class="p">}</span>

<span class="n">kg_extractor</span> <span class="o">=</span> <span class="n">SchemaLLMPathExtractor</span><span class="p">(</span>
    <span class="n">llm</span><span class="o">=</span><span class="n">llm</span><span class="p">,</span>
    <span class="n">possible_entities</span><span class="o">=</span><span class="n">entities</span><span class="p">,</span>
    <span class="n">possible_relations</span><span class="o">=</span><span class="n">relations</span><span class="p">,</span>
    <span class="n">kg_validation_schema</span><span class="o">=</span><span class="n">schema</span><span class="p">,</span>
    <span class="n">strict</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># if false, will allow triplets outside of the schema</span>
    <span class="n">num_workers</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
    <span class="n">max_triplets_per_chunk</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>
<p>This extractor is extremely customizable, and has options to customize
- various aspects of the schema (as seen above)
- the <code>extract_prompt</code>
- <code>strict=False</code> vs. <code>strict=True</code>, to allow triples outside of the schema or not
- passing in your own custom <code>kg_schema_cls</code> if you are a pydantic pro and wanted to create you own pydantic class with custom validation.</p>
<h3 id="retrieval-and-querying">Retrieval and Querying<a class="headerlink" href="#retrieval-and-querying" title="Permanent link">#</a></h3>
<p>Labeled property graphs can be queried in several ways to retrieve nodes and paths. And in LlamaIndex, we can combine several node retrieval methods at once!</p>
<div class="highlight"><pre><span></span><code><span class="c1"># create a retriever</span>
<span class="n">retriever</span> <span class="o">=</span> <span class="n">index</span><span class="o">.</span><span class="n">as_retriever</span><span class="p">(</span><span class="n">sub_retrievers</span><span class="o">=</span><span class="p">[</span><span class="n">retriever1</span><span class="p">,</span> <span class="n">retriever2</span><span class="p">,</span> <span class="o">...</span><span class="p">])</span>

<span class="c1"># create a query engine</span>
<span class="n">query_engine</span> <span class="o">=</span> <span class="n">index</span><span class="o">.</span><span class="n">as_query_engine</span><span class="p">(</span>
    <span class="n">sub_retrievers</span><span class="o">=</span><span class="p">[</span><span class="n">retriever1</span><span class="p">,</span> <span class="n">retriever2</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
<span class="p">)</span>
</code></pre></div>
<p>If no sub-retrievers are provided, the defaults are
<code>LLMSynonymRetriever</code> and <code>VectorContextRetriever</code> (if embeddings are enabled).</p>
<p>All retrievers currently include:
- <code>LLMSynonymRetriever</code> - retrieve based on LLM generated keywords/synonyms
- <code>VectorContextRetriever</code> - retrieve based on embedded graph nodes
- <code>TextToCypherRetriever</code> - ask the LLM to generate cypher based on the schema of the property graph
- <code>CypherTemplateRetriever</code> - use a cypher template with params inferred by the LLM
- <code>CustomPGRetriever</code> - easy to subclass and implement custom retrieval logic</p>
<p>Generally, you would define one or more of these sub-retrievers and pass them to the <code>PGRetriever</code>:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">llama_index.core.indices.property_graph</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">PGRetriever</span><span class="p">,</span>
    <span class="n">VectorContextRetriever</span><span class="p">,</span>
    <span class="n">LLMSynonymRetriever</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">sub_retrievers</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">VectorContextRetriever</span><span class="p">(</span><span class="n">index</span><span class="o">.</span><span class="n">property_graph_store</span><span class="p">,</span> <span class="o">...</span><span class="p">),</span>
    <span class="n">LLMSynonymRetriever</span><span class="p">(</span><span class="n">index</span><span class="o">.</span><span class="n">property_graph_store</span><span class="p">,</span> <span class="o">...</span><span class="p">),</span>
<span class="p">]</span>

<span class="n">retriever</span> <span class="o">=</span> <span class="n">PGRetriever</span><span class="p">(</span><span class="n">sub_retrievers</span><span class="o">=</span><span class="n">sub_retrievers</span><span class="p">)</span>

<span class="n">nodes</span> <span class="o">=</span> <span class="n">retriever</span><span class="o">.</span><span class="n">retrieve</span><span class="p">(</span><span class="s2">&quot;&lt;query&gt;&quot;</span><span class="p">)</span>
</code></pre></div>
<p>Read on below for more details on all retrievers.</p>
<h4 id="default-llmsynonymretriever">(default) <code>LLMSynonymRetriever</code><a class="headerlink" href="#default-llmsynonymretriever" title="Permanent link">#</a></h4>
<p>The <code>LLMSynonymRetriever</code> takes the query, and tries to generate keywords and synonyms to retrieve nodes (and therefore the paths connected to those nodes).</p>
<p>Explicitly declaring the retriever allows you to customize several options. Here are the defaults:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">llama_index.core.indices.property_graph</span> <span class="kn">import</span> <span class="n">LLMSynonymRetriever</span>

<span class="n">prompt</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s2">&quot;Given some initial query, generate synonyms or related keywords up to </span><span class="si">{max_keywords}</span><span class="s2"> in total, &quot;</span>
    <span class="s2">&quot;considering possible cases of capitalization, pluralization, common expressions, etc.</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="s2">&quot;Provide all synonyms/keywords separated by &#39;^&#39; symbols: &#39;keyword1^keyword2^...&#39;</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="s2">&quot;Note, result should be in one-line, separated by &#39;^&#39; symbols.&quot;</span>
    <span class="s2">&quot;----</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="s2">&quot;QUERY: </span><span class="si">{query_str}</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="s2">&quot;----</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="s2">&quot;KEYWORDS: &quot;</span>
<span class="p">)</span>


<span class="k">def</span> <span class="nf">parse_fn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
    <span class="n">matches</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;^&quot;</span><span class="p">)</span>

    <span class="c1"># capitalize to normalize with ingestion</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">matches</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()]</span>


<span class="n">synonym_retriever</span> <span class="o">=</span> <span class="n">LLMSynonymRetriever</span><span class="p">(</span>
    <span class="n">index</span><span class="o">.</span><span class="n">property_graph_store</span><span class="p">,</span>
    <span class="n">llm</span><span class="o">=</span><span class="n">llm</span><span class="p">,</span>
    <span class="c1"># include source chunk text with retrieved paths</span>
    <span class="n">include_text</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">synonym_prompt</span><span class="o">=</span><span class="n">prompt</span><span class="p">,</span>
    <span class="n">output_parsing_fn</span><span class="o">=</span><span class="n">parse_fn</span><span class="p">,</span>
    <span class="n">max_keywords</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="c1"># the depth of relations to follow after node retrieval</span>
    <span class="n">path_depth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">retriever</span> <span class="o">=</span> <span class="n">index</span><span class="o">.</span><span class="n">as_retriever</span><span class="p">(</span><span class="n">sub_retrievers</span><span class="o">=</span><span class="p">[</span><span class="n">synonym_retriever</span><span class="p">])</span>
</code></pre></div>
<h4 id="default-if-supported-vectorcontextretriever">(default, if supported) <code>VectorContextRetriever</code><a class="headerlink" href="#default-if-supported-vectorcontextretriever" title="Permanent link">#</a></h4>
<p>The <code>VectorContextRetriever</code> retrieves nodes based on their vector similarity, and then fetches the paths connected to those nodes.</p>
<p>If your graph store supports vectors, then you only need to manage that graph store for storage. Otherwise, you will need to provide a vector store in addition to the graph store (by default, uses the in-memory <code>SimpleVectorStore</code>).</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">llama_index.core.indices.property_graph</span> <span class="kn">import</span> <span class="n">VectorContextRetriever</span>

<span class="n">vector_retriever</span> <span class="o">=</span> <span class="n">VectorContextRetriever</span><span class="p">(</span>
    <span class="n">index</span><span class="o">.</span><span class="n">property_graph_store</span><span class="p">,</span>
    <span class="c1"># only needed when the graph store doesn&#39;t support vector queries</span>
    <span class="c1"># vector_store=index.vector_store,</span>
    <span class="n">embed_model</span><span class="o">=</span><span class="n">embed_model</span><span class="p">,</span>
    <span class="c1"># include source chunk text with retrieved paths</span>
    <span class="n">include_text</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="c1"># the number of nodes to fetch</span>
    <span class="n">similarity_top_k</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="c1"># the depth of relations to follow after node retrieval</span>
    <span class="n">path_depth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="c1"># can provide any other kwargs for the VectorStoreQuery class</span>
    <span class="o">...</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">retriever</span> <span class="o">=</span> <span class="n">index</span><span class="o">.</span><span class="n">as_retriever</span><span class="p">(</span><span class="n">sub_retrievers</span><span class="o">=</span><span class="p">[</span><span class="n">vector_retriever</span><span class="p">])</span>
</code></pre></div>
<h4 id="texttocypherretriever"><code>TextToCypherRetriever</code><a class="headerlink" href="#texttocypherretriever" title="Permanent link">#</a></h4>
<p>The <code>TextToCypherRetriever</code> uses a graph store schema, your query, and a prompt template for text-to-cypher in order to generate and execute a cypher query.</p>
<p><strong>NOTE:</strong> Since the <code>SimplePropertyGraphStore</code> is not actually a graph database, it does not support cypher queries.</p>
<p>You can inspect the schema by using <code>index.property_graph_store.get_schema_str()</code>.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">llama_index.core.indices.property_graph</span> <span class="kn">import</span> <span class="n">TextToCypherRetriever</span>

<span class="n">DEFAULT_RESPONSE_TEMPLATE</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s2">&quot;Generated Cypher query:</span><span class="se">\n</span><span class="si">{query}</span><span class="se">\n\n</span><span class="s2">&quot;</span> <span class="s2">&quot;Cypher Response:</span><span class="se">\n</span><span class="si">{response}</span><span class="s2">&quot;</span>
<span class="p">)</span>
<span class="n">DEFAULT_ALLOWED_FIELDS</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="s2">&quot;label&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">]</span>

<span class="n">DEFAULT_TEXT_TO_CYPHER_TEMPLATE</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">index</span><span class="o">.</span><span class="n">property_graph_store</span><span class="o">.</span><span class="n">text_to_cypher_template</span><span class="p">,</span>
<span class="p">)</span>


<span class="n">cypher_retriever</span> <span class="o">=</span> <span class="n">TextToCypherRetriever</span><span class="p">(</span>
    <span class="n">index</span><span class="o">.</span><span class="n">property_graph_store</span><span class="p">,</span>
    <span class="c1"># customize the LLM, defaults to Settings.llm</span>
    <span class="n">llm</span><span class="o">=</span><span class="n">llm</span><span class="p">,</span>
    <span class="c1"># customize the text-to-cypher template.</span>
    <span class="c1"># Requires `schema` and `question` template args</span>
    <span class="n">text_to_cypher_template</span><span class="o">=</span><span class="n">DEFAULT_TEXT_TO_CYPHER_TEMPLATE</span><span class="p">,</span>
    <span class="c1"># customize how the cypher result is inserted into</span>
    <span class="c1"># a text node. Requires `query` and `response` template args</span>
    <span class="n">response_template</span><span class="o">=</span><span class="n">DEFAULT_RESPONSE_TEMPLATE</span><span class="p">,</span>
    <span class="c1"># an optional callable that can clean/verify generated cypher</span>
    <span class="n">cypher_validator</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="c1"># allowed fields in the resulting</span>
    <span class="n">allowed_output_field</span><span class="o">=</span><span class="n">DEFAULT_ALLOWED_FIELDS</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>
<p><strong>NOTE:</strong> Executing arbitrary cypher has its risks. Ensure you take the needed measures (read-only roles, sandboxed env, etc.) to ensure safe usage in a production environment.</p>
<h4 id="cyphertemplateretriever"><code>CypherTemplateRetriever</code><a class="headerlink" href="#cyphertemplateretriever" title="Permanent link">#</a></h4>
<p>This is a more constrained version of the <code>TextToCypherRetriever</code>. Rather than letting the LLM have free-range of generating any cypher statement, we can instead provide a cypher template and have the LLM fill in the blanks.</p>
<p>To illustrate how this works, here is a small example:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># NOTE: current v1 is needed</span>
<span class="kn">from</span> <span class="nn">pydantic</span> <span class="kn">import</span> <span class="n">BaseModel</span><span class="p">,</span> <span class="n">Field</span>
<span class="kn">from</span> <span class="nn">llama_index.core.indices.property_graph</span> <span class="kn">import</span> <span class="n">CypherTemplateRetriever</span>

<span class="c1"># write a query with template params</span>
<span class="n">cypher_query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">MATCH (c:Chunk)-[:MENTIONS]-&gt;(o)</span>
<span class="s2">WHERE o.name IN $names</span>
<span class="s2">RETURN c.text, o.name, o.label;</span>
<span class="s2">&quot;&quot;&quot;</span>


<span class="c1"># create a pydantic class to represent the params for our query</span>
<span class="c1"># the class fields are directly used as params for running the cypher query</span>
<span class="k">class</span> <span class="nc">TemplateParams</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Template params for a cypher query.&quot;&quot;&quot;</span>

    <span class="n">names</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;A list of entity names or keywords to use for lookup in a knowledge graph.&quot;</span>
    <span class="p">)</span>


<span class="n">template_retriever</span> <span class="o">=</span> <span class="n">CypherTemplateRetriever</span><span class="p">(</span>
    <span class="n">index</span><span class="o">.</span><span class="n">property_graph_store</span><span class="p">,</span> <span class="n">TemplateParams</span><span class="p">,</span> <span class="n">cypher_query</span>
<span class="p">)</span>
</code></pre></div>
<h2 id="storage">Storage<a class="headerlink" href="#storage" title="Permanent link">#</a></h2>
<p>Currently, supported graph stores for property graphs include:</p>
<table>
<thead>
<tr>
<th></th>
<th>In-Memory</th>
<th>Native Embedding Support</th>
<th>Async</th>
<th>Server or disk based?</th>
</tr>
</thead>
<tbody>
<tr>
<td>SimplePropertyGraphStore</td>
<td></td>
<td></td>
<td></td>
<td>Disk</td>
</tr>
<tr>
<td>Neo4jPropertyGraphStore</td>
<td></td>
<td></td>
<td></td>
<td>Server</td>
</tr>
<tr>
<td>NebulaPropertyGraphStore</td>
<td></td>
<td></td>
<td></td>
<td>Server</td>
</tr>
<tr>
<td>TiDBPropertyGraphStore</td>
<td></td>
<td></td>
<td></td>
<td>Server</td>
</tr>
<tr>
<td>FalkorDBPropertyGraphStore</td>
<td></td>
<td></td>
<td></td>
<td>Server</td>
</tr>
</tbody>
</table>
<h3 id="saving-tofrom-disk">Saving to/from disk<a class="headerlink" href="#saving-tofrom-disk" title="Permanent link">#</a></h3>
<p>The default property graph store, <code>SimplePropertyGraphStore</code>, stores everything in memory and persists and loads from disk.</p>
<p>Here's an example of saving/loading an index with the default graph store:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">llama_index.core</span> <span class="kn">import</span> <span class="n">StorageContext</span><span class="p">,</span> <span class="n">load_index_from_storage</span>
<span class="kn">from</span> <span class="nn">llama_index.core.indices</span> <span class="kn">import</span> <span class="n">PropertyGraphIndex</span>

<span class="c1"># create</span>
<span class="n">index</span> <span class="o">=</span> <span class="n">PropertyGraphIndex</span><span class="o">.</span><span class="n">from_documents</span><span class="p">(</span><span class="n">documents</span><span class="p">)</span>

<span class="c1"># save</span>
<span class="n">index</span><span class="o">.</span><span class="n">storage_context</span><span class="o">.</span><span class="n">persist</span><span class="p">(</span><span class="s2">&quot;./storage&quot;</span><span class="p">)</span>

<span class="c1"># load</span>
<span class="n">storage_context</span> <span class="o">=</span> <span class="n">StorageContext</span><span class="o">.</span><span class="n">from_defaults</span><span class="p">(</span><span class="n">persist_dir</span><span class="o">=</span><span class="s2">&quot;./storage&quot;</span><span class="p">)</span>
<span class="n">index</span> <span class="o">=</span> <span class="n">load_index_from_storage</span><span class="p">(</span><span class="n">storage_context</span><span class="p">)</span>
</code></pre></div>
<h3 id="saving-and-loading-with-integrations">Saving and Loading with Integrations<a class="headerlink" href="#saving-and-loading-with-integrations" title="Permanent link">#</a></h3>
<p>Integrations typically save automatically. Some graph stores will support vectors, others might not. You can always combine a graph store with an external vector db as well.</p>
<p>This example shows how you might save/load a property graph index using Neo4j and Qdrant.</p>
<p><strong>Note:</strong> If qdrant wasn't passed in, neo4j would store and use the embeddings on its own. This example illustrates the flexibility beyond that.</p>
<p><code>pip install llama-index-graph-stores-neo4j llama-index-vector-stores-qdrant</code></p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">llama_index.core</span> <span class="kn">import</span> <span class="n">StorageContext</span><span class="p">,</span> <span class="n">load_index_from_storage</span>
<span class="kn">from</span> <span class="nn">llama_index.core.indices</span> <span class="kn">import</span> <span class="n">PropertyGraphIndex</span>
<span class="kn">from</span> <span class="nn">llama_index.graph_stores.neo4j</span> <span class="kn">import</span> <span class="n">Neo4jPropertyGraphStore</span>
<span class="kn">from</span> <span class="nn">llama_index.vector_stores.qdrant</span> <span class="kn">import</span> <span class="n">QdrantVectorStore</span>
<span class="kn">from</span> <span class="nn">qdrant_client</span> <span class="kn">import</span> <span class="n">QdrantClient</span><span class="p">,</span> <span class="n">AsyncQdrantClient</span>

<span class="n">vector_store</span> <span class="o">=</span> <span class="n">QdrantVectorStore</span><span class="p">(</span>
    <span class="s2">&quot;graph_collection&quot;</span><span class="p">,</span>
    <span class="n">client</span><span class="o">=</span><span class="n">QdrantClient</span><span class="p">(</span><span class="o">...</span><span class="p">),</span>
    <span class="n">aclient</span><span class="o">=</span><span class="n">AsyncQdrantClient</span><span class="p">(</span><span class="o">...</span><span class="p">),</span>
<span class="p">)</span>

<span class="n">graph_store</span> <span class="o">=</span> <span class="n">Neo4jPropertyGraphStore</span><span class="p">(</span>
    <span class="n">username</span><span class="o">=</span><span class="s2">&quot;neo4j&quot;</span><span class="p">,</span>
    <span class="n">password</span><span class="o">=</span><span class="s2">&quot;&lt;password&gt;&quot;</span><span class="p">,</span>
    <span class="n">url</span><span class="o">=</span><span class="s2">&quot;bolt://localhost:7687&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># creates an index</span>
<span class="n">index</span> <span class="o">=</span> <span class="n">PropertyGraphIndex</span><span class="o">.</span><span class="n">from_documents</span><span class="p">(</span>
    <span class="n">documents</span><span class="p">,</span>
    <span class="n">property_graph_store</span><span class="o">=</span><span class="n">graph_store</span><span class="p">,</span>
    <span class="c1"># optional, neo4j also supports vectors directly</span>
    <span class="n">vector_store</span><span class="o">=</span><span class="n">vector_store</span><span class="p">,</span>
    <span class="n">embed_kg_nodes</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># load from existing graph/vector store</span>
<span class="n">index</span> <span class="o">=</span> <span class="n">PropertyGraphIndex</span><span class="o">.</span><span class="n">from_existing</span><span class="p">(</span>
    <span class="n">property_graph_store</span><span class="o">=</span><span class="n">graph_store</span><span class="p">,</span>
    <span class="c1"># optional, neo4j also supports vectors directly</span>
    <span class="n">vector_store</span><span class="o">=</span><span class="n">vector_store</span><span class="p">,</span>
    <span class="n">embed_kg_nodes</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>
<h3 id="using-the-property-graph-store-directly">Using the Property Graph Store Directly<a class="headerlink" href="#using-the-property-graph-store-directly" title="Permanent link">#</a></h3>
<p>The base storage class for property graphs is the <code>PropertyGraphStore</code>. These property graph stores are constructed using different types of <code>LabeledNode</code> objects, and connected using <code>Relation</code> objects.</p>
<p>We can create these ourselves, and also insert ourselves!</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">llama_index.core.graph_stores</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">SimplePropertyGraphStore</span><span class="p">,</span>
    <span class="n">EntityNode</span><span class="p">,</span>
    <span class="n">Relation</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">llama_index.core.schema</span> <span class="kn">import</span> <span class="n">TextNode</span>

<span class="n">graph_store</span> <span class="o">=</span> <span class="n">SimplePropertyGraphStore</span><span class="p">()</span>

<span class="n">entities</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">EntityNode</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;llama&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;ANIMAL&quot;</span><span class="p">,</span> <span class="n">properties</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="s2">&quot;val&quot;</span><span class="p">}),</span>
    <span class="n">EntityNode</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;index&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;THING&quot;</span><span class="p">,</span> <span class="n">properties</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="s2">&quot;val&quot;</span><span class="p">}),</span>
<span class="p">]</span>

<span class="n">relations</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">Relation</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s2">&quot;HAS&quot;</span><span class="p">,</span>
        <span class="n">source_id</span><span class="o">=</span><span class="n">entities</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
        <span class="n">target_id</span><span class="o">=</span><span class="n">entities</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
        <span class="n">properties</span><span class="o">=</span><span class="p">{},</span>
    <span class="p">)</span>
<span class="p">]</span>

<span class="n">graph_store</span><span class="o">.</span><span class="n">upsert_nodes</span><span class="p">(</span><span class="n">entities</span><span class="p">)</span>
<span class="n">graph_store</span><span class="o">.</span><span class="n">upsert_relations</span><span class="p">(</span><span class="n">relations</span><span class="p">)</span>

<span class="c1"># optionally, we can also insert text chunks</span>
<span class="n">source_chunk</span> <span class="o">=</span> <span class="n">TextNode</span><span class="p">(</span><span class="n">id_</span><span class="o">=</span><span class="s2">&quot;source&quot;</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s2">&quot;My llama has an index.&quot;</span><span class="p">)</span>

<span class="c1"># create relation for each of our entities</span>
<span class="n">source_relations</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">Relation</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s2">&quot;HAS_SOURCE&quot;</span><span class="p">,</span>
        <span class="n">source_id</span><span class="o">=</span><span class="n">entities</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
        <span class="n">target_id</span><span class="o">=</span><span class="s2">&quot;source&quot;</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="n">Relation</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s2">&quot;HAS_SOURCE&quot;</span><span class="p">,</span>
        <span class="n">source_id</span><span class="o">=</span><span class="n">entities</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
        <span class="n">target_id</span><span class="o">=</span><span class="s2">&quot;source&quot;</span><span class="p">,</span>
    <span class="p">),</span>
<span class="p">]</span>
<span class="n">graph_store</span><span class="o">.</span><span class="n">upsert_llama_nodes</span><span class="p">([</span><span class="n">source_chunk</span><span class="p">])</span>
<span class="n">graph_store</span><span class="o">.</span><span class="n">upsert_relations</span><span class="p">(</span><span class="n">source_relations</span><span class="p">)</span>
</code></pre></div>
<p>Other helpful methods on the graph store include:
- <code>graph_store.get(ids=[])</code> - gets nodes based on ids
- <code>graph_store.get(properties={"key": "val"})</code> - gets nodes based on matching properties
- <code>graph_store.get_rel_map([entity_node], depth=2)</code> - gets triples up to a certain depth
- <code>graph_store.get_llama_nodes(['id1'])</code> - gets the original text nodes
- <code>graph_store.delete(ids=['id1'])</code> - delete based on ids
- <code>graph_store.delete(properties={"key": "val"})</code> - delete based on properties
- <code>graph_store.structured_query("&lt;cypher query&gt;")</code> - runs a cypher query (assuming the graph store supports it)</p>
<p>In addition <code>a</code> versions exist for all of these for async support (i.e. <code>aget</code>, <code>adelete</code>, etc.).</p>
<h2 id="advanced-customization">Advanced Customization<a class="headerlink" href="#advanced-customization" title="Permanent link">#</a></h2>
<p>As with all components in LlamaIndex, you can sub-class modules and customize things to work exactly as you need, or try out new ideas and research new modules!</p>
<h3 id="sub-classing-extractors">Sub-Classing Extractors<a class="headerlink" href="#sub-classing-extractors" title="Permanent link">#</a></h3>
<p>Graph extractors in LlamaIndex subclass the <code>TransformComponent</code> class. If you've worked with the ingestion pipeline before, this will be familiar since it is the same class.</p>
<p>The requirement for extractors is that the insert graph data into the metadata of the node, which will then be processed later on by the index.</p>
<p>Here is a small example of sub-classing to create a custom extractor:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">llama_index.core.graph_store.types</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">EntityNode</span><span class="p">,</span>
    <span class="n">Relation</span><span class="p">,</span>
    <span class="n">KG_NODES_KEY</span><span class="p">,</span>
    <span class="n">KG_RELATIONS_KEY</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">llama_index.core.schema</span> <span class="kn">import</span> <span class="n">BaseNode</span><span class="p">,</span> <span class="n">TransformComponent</span>


<span class="k">class</span> <span class="nc">MyGraphExtractor</span><span class="p">(</span><span class="n">TransformComponent</span><span class="p">):</span>
    <span class="c1"># the init is optional</span>
    <span class="c1"># def __init__(self, ...):</span>
    <span class="c1">#     ...</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">llama_nodes</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">BaseNode</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">BaseNode</span><span class="p">]:</span>
        <span class="k">for</span> <span class="n">llama_node</span> <span class="ow">in</span> <span class="n">llama_nodes</span><span class="p">:</span>
            <span class="c1"># be sure to not overwrite existing entities/relations</span>

            <span class="n">existing_nodes</span> <span class="o">=</span> <span class="n">llama_node</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">KG_NODES_KEY</span><span class="p">,</span> <span class="p">[])</span>
            <span class="n">existing_relations</span> <span class="o">=</span> <span class="n">llama_node</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">KG_RELATIONS_KEY</span><span class="p">,</span> <span class="p">[])</span>

            <span class="n">existing_nodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">EntityNode</span><span class="p">(</span>
                    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;llama&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;ANIMAL&quot;</span><span class="p">,</span> <span class="n">properties</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="s2">&quot;val&quot;</span><span class="p">}</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="n">existing_nodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">EntityNode</span><span class="p">(</span>
                    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;index&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;THING&quot;</span><span class="p">,</span> <span class="n">properties</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="s2">&quot;val&quot;</span><span class="p">}</span>
                <span class="p">)</span>
            <span class="p">)</span>

            <span class="n">existing_relations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">Relation</span><span class="p">(</span>
                    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;HAS&quot;</span><span class="p">,</span>
                    <span class="n">source_id</span><span class="o">=</span><span class="s2">&quot;llama&quot;</span><span class="p">,</span>
                    <span class="n">target_id</span><span class="o">=</span><span class="s2">&quot;index&quot;</span><span class="p">,</span>
                    <span class="n">properties</span><span class="o">=</span><span class="p">{},</span>
                <span class="p">)</span>
            <span class="p">)</span>

            <span class="c1"># add back to the metadata</span>

            <span class="n">llama_node</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="n">KG_NODES_KEY</span><span class="p">]</span> <span class="o">=</span> <span class="n">existing_nodes</span>
            <span class="n">llama_node</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="n">KG_RELATIONS_KEY</span><span class="p">]</span> <span class="o">=</span> <span class="n">existing_relations</span>

        <span class="k">return</span> <span class="n">llama_nodes</span>

    <span class="c1"># optional async method</span>
    <span class="c1"># async def acall(self, llama_nodes: list[BaseNode], **kwargs) -&gt; list[BaseNode]:</span>
    <span class="c1">#    ...</span>
</code></pre></div>
<h3 id="sub-classing-retrievers">Sub-Classing Retrievers<a class="headerlink" href="#sub-classing-retrievers" title="Permanent link">#</a></h3>
<p>The retriever is a bit more complicated than the extractors, and has it's own special class to help make sub-classing easier.</p>
<p>The return type of the retrieval is extremely flexible. It could be
- a string
- a <code>TextNode</code>
- a <code>NodeWithScore</code>
- a list of one of the above</p>
<p>Here is a small example of sub-classing to create a custom retriever:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">llama_index.core.indices.property_graph</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">CustomPGRetriever</span><span class="p">,</span>
    <span class="n">CUSTOM_RETRIEVE_TYPE</span><span class="p">,</span>
<span class="p">)</span>


<span class="k">class</span> <span class="nc">MyCustomRetriever</span><span class="p">(</span><span class="n">CustomPGRetriever</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">init</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">my_option_1</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Uses any kwargs passed in from class constructor.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">my_option_1</span> <span class="o">=</span> <span class="n">my_option_1</span>
        <span class="c1"># optionally do something with self.graph_store</span>

    <span class="k">def</span> <span class="nf">custom_retrieve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query_str</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CUSTOM_RETRIEVE_TYPE</span><span class="p">:</span>
        <span class="c1"># some some operation with self.graph_store</span>
        <span class="k">return</span> <span class="s2">&quot;result&quot;</span>

    <span class="c1"># optional async method</span>
    <span class="c1"># async def acustom_retrieve(self, query_str: str) -&gt; str:</span>
    <span class="c1">#     ...</span>


<span class="n">custom_retriever</span> <span class="o">=</span> <span class="n">MyCustomRetriever</span><span class="p">(</span><span class="n">graph_store</span><span class="p">,</span> <span class="n">my_option_1</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">retriever</span> <span class="o">=</span> <span class="n">index</span><span class="o">.</span><span class="n">as_retriever</span><span class="p">(</span><span class="n">sub_retrievers</span><span class="o">=</span><span class="p">[</span><span class="n">custom_retriever</span><span class="p">])</span>
</code></pre></div>
<p>For more complicated customization and use-cases, it is recommended to check out the source code and directly sub-class <code>BasePGRetriever</code>.</p>
<h1 id="examples">Examples<a class="headerlink" href="#examples" title="Permanent link">#</a></h1>
<p>Below, you can find some example notebooks showcasing the <code>PropertyGraphIndex</code></p>
<ul>
<li><a href="../../../examples/property_graph/property_graph_basic/">Basic Usage</a></li>
<li><a href="../../../examples/property_graph/property_graph_neo4j/">Using Neo4j</a></li>
<li><a href="../../../examples/property_graph/property_graph_nebula/">Using Nebula</a></li>
<li><a href="../../../examples/property_graph/property_graph_advanced/">Advanced Usage with Neo4j and local models</a></li>
<li><a href="../../../examples/property_graph/graph_store/">Using a Property Graph Store</a></li>
<li><a href="../../../examples/property_graph/property_graph_custom_retriever/">Creating a Custom Graph Retriever</a></li>
<li><a href="../../../examples/property_graph/Dynamic_KG_Extraction/">Comparing KG Extractors</a></li>
</ul>









  




                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
       
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../vector_store_index/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Vector Store Index">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Vector Store Index
              </div>
            </div>
          </a>
        
        
          
          <a href="../document_management/" class="md-footer__link md-footer__link--next" aria-label="Next: Document Management">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Document Management
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <readthedocs-flyout position="bottom-left"></readthedocs-flyout>
      
    </div>
  </div>
</footer>
      
<!-- Google Tag Manager -->
<script>
  (function (w, d, s, l, i) {
    w[l] = w[l] || [];
    w[l].push({ "gtm.start": new Date().getTime(), event: "gtm.js" });
    var f = d.getElementsByTagName(s)[0],
      j = d.createElement(s),
      dl = l != "dataLayer" ? "&l=" + l : "";
    j.async = true;
    j.src = "https://www.googletagmanager.com/gtm.js?id=" + i + dl;
    f.parentNode.insertBefore(j, f);
  })(window, document, "script", "dataLayer", "GTM-WWRFB36R");
</script>
<!-- End Google Tag Manager -->

    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.instant", "navigation.prune", "navigation.tabs", "navigation.indexes", "navigation.top", "navigation.footer", "toc.follow", "content.code.copy", "search.suggest", "search.highlight"], "search": "../../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.13a4f30d.min.js"></script>
      
        <script src="../../../javascript/runllm.js"></script>
      
        <script src="../../../javascript/algolia.js"></script>
      
    
  </body>
</html>